IF ( NOT LAPACK_VENDOR )
    MESSAGE( FATAL_ERROR "LAPACK_VENDOR must be set" )
ENDIF()


SET( LAPACK_OUT "${CMAKE_CURRENT_BINARY_DIR}/tmp/LAPACK_OUT.cmake" )
FILE( WRITE "${LAPACK_OUT}" "" )
FILE( APPEND "${LAPACK_OUT}" "    SET(LAPACK_INSTALL_DIR \"${LAPACK_INSTALL_DIR}\")\n" )


# Create blas_lapack.h
SET( BLAS_LAPACK_HEADER "${CMAKE_INSTALL_PREFIX}/include/blas_lapack.h" )
FILE( WRITE "${BLAS_LAPACK_HEADER}" "// Auto-generated file to include BLAS/LAPACK headers\n" )
IF ( LAPACK_VENDOR MATCHES "MATLAB" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${MATLAB_INSTALL_DIR}/extern/include/tmwtypes.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${MATLAB_INSTALL_DIR}/extern/include/blas.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${MATLAB_INSTALL_DIR}/extern/include/lapack.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_BLAS\n  #define USE_BLAS\n#endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_LAPACK\n  #define USE_LAPACK\n#endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_MATLAB_LAPACK\n  #define USE_MATLAB_LAPACK\n#endif\n" )
ELSEIF ( LAPACK_VENDOR MATCHES "ACML" )
    FILE( APPEND "${LAPACK_OUT}" "SET(USE_ACML true)\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(ACML_DIR \"${LAPACK_INSTALL_DIR}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(ACML_DIRECTORY \"${LAPACK_INSTALL_DIR}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET( CMAKE_INSTALL_RPATH $\{CMAKE_INSTALL_RPATH} \"${INSTALL_PATH}/lib\" )\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${LAPACK_INCLUDE_DIRS}/acml.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_BLAS\n #define USE_BLAS\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_LAPACK\n #define USE_LAPACK\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_ACML\n #define USE_ACML\n #endif\n" )
ELSEIF ( LAPACK_VENDOR MATCHES "MKL" )
    FILE( APPEND "${LAPACK_OUT}" "SET(USE_MKL true)\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(MKL_DIR \"${INSTALL_PATH}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(MKL_DIRECTORY \"${INSTALL_PATH}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET( CMAKE_INSTALL_RPATH $\{CMAKE_INSTALL_RPATH} \"${MKL_LIB_DIR}\" )\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${BLAS_INCLUDE_DIRS}/mkl_blas.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${LAPACK_INCLUDE_DIRS}/mkl_lapack.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_BLAS\n #define USE_BLAS\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_LAPACK\n #define USE_LAPACK\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_MKL\n #define USE_MKL\n #endif\n" )
ELSEIF ( LAPACK_VENDOR MATCHES "OpenBLAS" )
    FILE( APPEND "${LAPACK_OUT}" "SET(USE_OPENBLAS true)\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(OPENBLAS_DIR \"${INSTALL_PATH}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(OPENBLAS_DIRECTORY \"${INSTALL_PATH}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET( CMAKE_INSTALL_RPATH $\{CMAKE_INSTALL_RPATH} \"${INSTALL_PATH}/lib\" )\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${BLAS_INCLUDE_DIRS}/cblas.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${LAPACK_INCLUDE_DIRS}/lapacke.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_BLAS\n #define USE_BLAS\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_LAPACK\n #define USE_LAPACK\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_OPENBLAS\n #define USE_OPENBLAS\n #endif\n" )
ELSEIF ( LAPACK_VENDOR MATCHES "VECLIB" )
    FILE( APPEND "${LAPACK_OUT}" "SET(USE_VECLIB true)\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(VECLIB_DIR \"${INSTALL_PATH}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET(VECLIB_DIRECTORY \"${INSTALL_PATH}\")\n" )
    FILE( APPEND "${LAPACK_OUT}" "SET( CMAKE_INSTALL_RPATH $\{CMAKE_INSTALL_RPATH} \"${INSTALL_PATH}/lib\" )\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${LAPACK_INCLUDE_DIRS}/cblas.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#include \"${BLAS_INCLUDE_DIRS}/lapacke.h\"\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_BLAS\n #define USE_BLAS\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_LAPACK\n #define USE_LAPACK\n #endif\n" )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "#ifndef USE_VECLIB\n #define USE_VECLIB\n #endif\n" )
ELSEIF ( LAPACK_VENDOR MATCHES "Default" OR LAPACK_VENDOR MATCHES "Generic" )
    SET( BLAS_LAPACK_LINK "${LAPACK_LIBS}" "${BLAS_LIBS}" )
    FILE( READ "${CMAKE_CURRENT_LIST_DIR}/DefaultLapackInterface.h" LAPACK_HEADER )
    FILE( APPEND "${BLAS_LAPACK_HEADER}" "${LAPACK_HEADER}" )
    IF ( BLAS_LIB )
        FILE( APPEND "${LAPACK_OUT}" "SET(BLAS_DIRECTORY \"${BLAS_LIB_DIR}\")\n" )
        FILE( APPEND "${LAPACK_OUT}" "SET(BLAS_LIB \"${BLAS_LIB}\")\n" )
    ENDIF()
    IF ( LAPACK_LIB )
        FILE( APPEND "${LAPACK_OUT}" "SET(LAPACK_DIRECTORY \"${LAPACK_LIB_DIR}\")\n" )
        FILE( APPEND "${LAPACK_OUT}" "SET(LAPACK_LIB \"${LAPACK_LIB}\")\n" )
    ENDIF()
ELSE()
    MESSAGE( FATAL_ERROR "Unknown vendor: ${LAPACK_VENDOR}" )
ENDIF()





